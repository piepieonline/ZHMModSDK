cmake_minimum_required (VERSION 3.8)

if(POLICY CMP0091)
	cmake_policy(SET CMP0091 NEW)
endif()

project(ZHMMods CXX C)

set(INSTALL_PATH "" CACHE PATH "Path to Hitman 3 retail folder to install the SDK in.")

set(CMAKE_CXX_STANDARD 23)

set(ZLIB_USE_STATIC_LIBS "ON")

if(CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
	set(VCPKG_CRT_LINKAGE "static")
	set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
	
	string(REPLACE "/MDd" "" CMAKE_CXX_FLAGS_DEBUG ${CMAKE_CXX_FLAGS_DEBUG})
endif()

# Dependencies.
find_package(7zip CONFIG REQUIRED)
find_package(directxtk12 CONFIG REQUIRED)
find_package(minhook CONFIG REQUIRED)
find_package(spdlog CONFIG REQUIRED)
add_subdirectory("External/imgui")
add_subdirectory("External/imguizmo")
add_subdirectory("External/zlib")

# Core modules.
add_subdirectory("ZHMModSDK")
add_subdirectory("DirectInputProxy")

# Mods.
add_subdirectory("Mods/WakingUpNpcs")
add_subdirectory("Mods/NoPause")
add_subdirectory("Mods/SkipIntro")
add_subdirectory("Mods/CodeGen")
add_subdirectory("Mods/CertPinBypass")
add_subdirectory("Mods/MaxPatchLevel")
add_subdirectory("Mods/DebugMod")
add_subdirectory("Mods/AdvancedRating")
add_subdirectory("Mods/FreeCam")
add_subdirectory("Mods/DiscordRichPresence")
add_subdirectory("Mods/LogPins")
add_subdirectory("ModsPrivate/OnlineJsonMods")
add_subdirectory("ModsPrivate/FreelancerVariations")

# Tools.
add_subdirectory("Tools/DevLoader")

# Make sure to compile everything before the devloader.
add_dependencies(DevLoader 
	DirectInputProxy 
	ZHMModSDK 
	WakingUpNpcs
	NoPause
	SkipIntro
	CodeGen
	CertPinBypass
	MaxPatchLevel
	DebugMod
	AdvancedRating
	FreeCam
	DiscordRichPresence
	LogPins
	OnlineJsonMods
	FreelancerVariations
)

if (EXISTS "${INSTALL_PATH}")
	install(TARGETS ZHMModSDK DirectInputProxy 
		RUNTIME DESTINATION "${INSTALL_PATH}"
	)

	install(TARGETS WakingUpNpcs NoPause SkipIntro CodeGen CertPinBypass MaxPatchLevel DebugMod AdvancedRating FreeCam DiscordRichPresence LogPins OnlineJsonMods FreelancerVariations
		RUNTIME DESTINATION "${INSTALL_PATH}/mods"
	)
endif()
